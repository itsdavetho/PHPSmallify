<?php
namespace Orpheus;class MCStatus{protected $a=array('online'=>false,'version'=>null,'motd'=>null,'players'=>-1,'maxPlayers'=>-1); public function __construct($b=null,$c=25565){if($b!==null){$this->setServer($b,$c);}} public function setServer($b,$c=25565){if($c===null){$c=25565;}$this->b=$this->a['ip']=$b;$this->c=$this->a['port']=(int) $c;if($this->c<0||$this->c>65535){throw new\Exception(__METHOD__.': Port range: 1-65535');}} public function getStatus($d=true){$e=@fsockopen($this->b,$this->c,$f,$g,5);if($e===false){$this->a['online']=false;return $this->a;}fwrite($e,"\xFE\x01");$h=fread($e,256);if(substr($h,0,1)!="\xff"){$this->a['online']=false;return $this->a;}else{if(substr($h,3,5)=="\x00\xa7\x00\x31\x00"){$h=mb_convert_encoding(substr($h,15),'UTF-8','UCS-2');$h=explode("\x00",$h);}$i=$d==true?$this->formatString($h[count($h)-3]):preg_replace('/((\d))/','',$h[count($h)-3]);$this->a=array('ip'=>$this->b,'port'=>$this->c,'online'=>true,'version'=>$h[0],'motd'=>$i,'players'=>(int) $h[count($h)-2],'maxPlayers'=>(int) $h[count($h)-1]);return $this->a;}} protected function formatString($j){preg_match_all('/(([\d\w]))/',$j,$k);$l=json_decode(file_get_contents(__DIR__.'/formats.json'),true);$m=0;foreach($k[1]as $n=>$d){$j=preg_replace('/'.$d.'/','<span style="'.$l[$k[2][$n]].'">',$j);$m++;}for($o=0;$o<$m;$o++){$j.='</span>';}return $j;}}?>